<script type="text/javascript">$(document).ready(function(){const e=$("ul.pagination[role='navigation'] li");function t(){let e=$(".add-bill-form .bid"),t=($(".add-bill-form .jssearch-select"),$(".add-bill-form .slist"),$(".add-bill-form .product-table .table-body"));var a=$(".add-bill-form .product-table .price-total span"),l=$(".add-bill-form .product-table .vat-total span"),r=$(".add-bill-form .product-table .bill-total span"),o=($(".add-bill-form .product-table tbody:last-of-type"),JSON.parse("{{$vats}}".replace(/&quot;/g,'"')));$(".edit-bill").click(function(){var n=$(this).parent().parent().attr("data-row"),s="{{route('bills.show', 'x')}}";s=s.replace("x",n),$.get(s,{type:"GET"},function(s){var i="{{route('bills.update', 'x')}}";i=i.replace("x",n),$(".add-bill-form .input-group-content").hide(),$(".add-bill-form .input-group-footer").hide(),$(".add-bill-form .input-group-search").hide(),$(".add-bill-form .jssearch-change").show(),$(".add-bill-form .jssearch-select").hide(),$(".add-bill-form .input-group-header").css({"border-radius":"0.25rem","border-bottom":"1px solid #ced4da"}),$(".add-bill-form form").attr("action",i),$(".add-bill-form form").prepend('{{method_field("PATCH")}}'),$(".add-bill-form .sbm").val("{{$json->$hl->accounting->edit}} {{$json->$hl->accounting->bill}}"),$(".add-bill-form .box-header h4").html("{{$json->$hl->accounting->edit}} {{$json->$hl->accounting->bill}}"),e.val(n);var c=Number(a.html())>0?Number(a.html()):0,d=Number(l.html())>0?Number(l.html()):0;for(product of s.products){var u='<select class="form-control vlist" name="vat[]" style="display: none;">';for(vat of(u+='<option value="0" data-value="0">None</option>',u+=null!=product.vat_name?'<option selected value="'+product.vat_id+'" data-value="'+product.vat_value+'">'+product.vat_name+" ("+product.vat_value+"%)</option>":"",o))vat.id!=product.vat_id&&(u+='<option value="'+vat.id+'" data-value="'+vat.vat_value+'">'+vat.vat_name+" ("+vat.vat_value+"%)</option>");u+="</select>";var p='<tr><th scope="row"><span>'+product.product_id+'</span><input class="form-control" type="hidden" name="pid[]" placeholder="{{$json->$hl->accounting->eg_id}}" value="'+product.product_id+'"/><input type="hidden" name="prid[]" value="'+product.id+'"/></th><td><span>'+product.product_name+'</span><input class="form-control" type="hidden" name="product[]" value="'+product.product_name+'"/></td><td class="price"><span class="price-value">'+product.product_price.toFixed(2)+'</span><input type="hidden" name="price[]" class="form-control" value="'+product.product_price.toFixed(2)+'"/></td><td><span class="vat-text">'+(null!=product.vat_name?product.vat_name:"{{$json->$hl->general->none}}")+" "+(null!=product.vat_value?"("+product.vat_value+"%) ":"")+(null!=product.vat_name?(product.product_price*(product.vat_value/100)).toFixed(2):"")+"</span>"+u+'</td><td class="actions"><a href="javascript: void(0);" class="edit-product"><i class="{{$json->icons->edit}}"></i></a> <a href="javascript: void(0);" class="ac-product" style="display: none;"><i class="{{$json->icons->checked}}"></i></a> <a href="javascript: void(0);" class="cancel-product"><i class="{{$json->icons->close}}"></i></a></td></tr>';c+=product.product_price,d+=product.product_price*(product.vat_value/100),t.append(p),$(".cancel-product",t).click(function(){$(this).parent().parent().remove();var e=Number(a.html())>0?Number(a.html()):e,t=Number(l.html())>0?Number(l.html()):t;e-=product.product_price,t-=product.product_price*(product.vat_value/100),a.html(e.toFixed(2)),l.html(t.toFixed(2)),r.html((e+t).toFixed(2))}),$(".edit-product",t).click(function(){c=Number(a.html())>0?Number(a.html()):0,d=Number(l.html())>0?Number(l.html()):0;var e=$(this);e.hide();var o=!1;$(".ac-product",$(this).parent()).show();var n=$(this).parent().parent(),s=$("th .form-control",n),i=$("th span",n),u=$("input[name='product[]']",n),p=u.parent().children("span"),m=$(".price .form-control",n),v=$(".price .currency",n),h=$(".price .price-value",n),y=$("select[name='vat[]']",n),b=$(".vat-text",n);c-=Number(m.val()),d-=Number(m.val()*(y.find(":selected").attr("data-value")/100)),i.hide(),s.attr("type","number"),u.attr("type","text"),p.hide(),m.attr("type","number"),v.hide(),h.hide(),y.show(),b.hide(),$(".ac-product",t).click(function(){0==o&&(i.html(s.val()).show(),s.attr("type","hidden"),u.attr("type","hidden"),p.html(u.val()).show(),m.attr("type","hidden"),v.show(),h.html(m.val()).show(),y.hide(),b.html(y.find(":selected").text()+" "+Number(m.val()*(y.find(":selected").attr("data-value")/100)).toFixed(2)).show(),e.show(),$(this).hide(),c+=Number(m.val()),d+=Number(m.val()*(y.find(":selected").attr("data-value")/100)),a.html(c.toFixed(2)),l.html(d.toFixed(2)),r.html((c+d).toFixed(2)),o=!0)})})}a.html(c.toFixed(2)),l.html(d.toFixed(2)),r.html((c+d).toFixed(2)),$(".add-bill-form .slist").val(s.customer_id),$(".add-bill-form .jssearch-selected").html(s.customer),$(".filter").show(),$(".add-bill-form").show(),$(".close-bill").click(function(){$(".filter").hide(),$(".add-bill-form").hide(),$(".add-bill-form .bid").val("{{$bills->highestId}}"),a.html((0).toFixed(2)),l.html((0).toFixed(2)),r.html((0).toFixed(2)),t.html("")})})})}t();var a,l,r,o,n=!1,s=$(".bills tr"),i=[];function c(e){var a;if(""!=e&&null!=e){for(bill of e){var l="{{route('customers.show', 'x')}}";l.replace("x",bill.customer_id);var r="{{route('bills.destroy', 'x')}}";r.replace("x",bill.id),a+='<tr data-row="'+bill.id+'"><th>'+bill.bill_id+'</th><td><a href="'+l+'">'+bill.company+"</a></td><td>"+bill.entry_date+'</td><td><a href="#" class="icon"><i class="{{$json->icons->pdf}}"></i></a> <a href="javascript: void(0);" class="icon edit-bill"><i class="{{$json->icons->edit}}"></i></a> <a href="#" class="icon"><i class="{{$json->icons->cancel}}"></i></a> <a href="'+r+'" class="icon"><i class="{{$json->icons->trash}}"></i></a></td></tr>'}pagi_html=!1}else a='<th scope="row" colspan="5" style="text-align: center;">{{$json->$hl->accounting->no_bills}}</th>';$(".bills").html(a),t()}var d=1;function u(e,t,a){d=1;for(var l=$("ul.pagination[role='navigation']"),s=$("li.page-item"),u=s[0],p=s[s.length-1],m=0;m<s.length;m++)0!=m&&m!=s.length-1?$(s[m]).remove():$("a",s[m]).attr("href","javascript: void(0)");e.current_page>1?$(u).removeClass("disabled"):-1==$(u).attr("class").indexOf("disabled")&&$(u).addClass("disabled"),d<e.last_page?$(p).removeClass("disabled"):-1==$(p).attr("class").indexOf("disabled")&&$(p).addClass("disabled");for(m=e.last_page;m>0;m--)$(u).after('<li class="page-item'+(m===e.current_page?" active":"")+'">'+(m===e.current_page?'<span class="page-link">'+m+"</span>":'<a class="page-link" href="javascript: void(0);" data-value="'+m+'">'+m+"</a>")+"</li>");$(".page-item",l).click(function(){0!=n||$(this).hasClass("next-page")||$(this).hasClass("prev-page")||(n=!0,function(l,n){if($("a",l).attr("data-value")&&$("a",l).attr("data-value")<=e.last_page){var s=$("a",l).attr("data-value");if(d=s,n.removeClass("active").html('<a class="page-link" href="javascript:void(0);" data-value="'+$(n).text()+'">'+$(n).text()+"</a>"),l.addClass("active").html('<span class="page-link">'+$(l).text()+"</span>"),i.length>0){var m=r+"/?page="+d;$.get(m,o,function(e){c(e.data)})}else $.get(t+"/?page="+d,a,function(e){c(e.data)})}d>1?$(u).removeClass("disabled"):$(u).addClass("disabled"),d<e.last_page?$(p).removeClass("disabled"):-1==$(p).attr("class").indexOf("disabled")&&$(p).addClass("disabled")}($(this),$(".active",$(this).parent())))}).mouseup(function(){n=!1}),$(".next-page",l).click(function(){if(!$(this).hasClass("disabled")&&0==n){if(n=!0,d=++d,i.length>0){var s=r+"/?page="+d;$.get(s,o,function(e){c(e.data)})}else $.get(t+"/?page="+d,a,function(e){c(e.data)});for(var u=$(".page-item",l),p=!1,m=0;m<u.length;m++)if($(u[m]).hasClass("active")&&!$(u[m]).hasClass(".prev-page")&&!$(u[m]).hasClass(".next-page")){0==p&&($(u[m+1]).addClass("active"),$(u[m+1]).html('<span class="page-link">'+d+"</span>"),$(u[m]).removeClass("active"),$(u[m]).html('<a href="javascript: void(0);" class="page-link" data-value="'+$(u[m]).text()+'">'+$(u[m]).text()+"</a>"),p=!0);break}console.log("next: "+d),d>=e.last_page&&$(".next-page").addClass("disabled"),$(".prev-page").hasClass("disabled")&&$(".prev-page").removeClass("disabled")}}).mouseup(function(){n=!1}),$(".prev-page",l).click(function(){if(!$(this).hasClass("disabled")&&0==n){if(n=!0,d=d-1>0?d-1:1,i.length>0){var e=r+"/?page="+d;$.get(e,o,function(e){c(e.data)})}else $.get(t+"/?page="+d,a,function(e){c(e.data)});var s=$(".page-item",l);for(pItem of s)$(pItem).hasClass("active")&&($(pItem).removeClass("active"),$(pItem).html('<a href="javascript: void(0);" class="page-link" data-value="'+$(pItem).text()+'">'+$(pItem).text()+"</a>"),$(pItem).prev().addClass("active"),$(pItem).prev().html('<span class="page-link">'+d+"</span>"));d<2&&$(u).addClass("disabled"),$(p).hasClass("disabled")&&$(p).removeClass("disabled")}}).mouseup(function(){n=!1})}var p=!1;$(".search .searchbar").keyup(function(){var t=$(this).val();if(""!=t&&null!=t){p=!0;var a=-1!="{{Route::current()->getName()}}".indexOf("bills")?"Bill":-1!="{{Route::current()->getName()}}".indexOf("customers")?"Customer":"Offer",l="{{route('search')}}",r=!1;i.length>0&&(r=i[0]),$.get(l,{q:t,t:a,sort:r},function(e){e.data;c(e.data),u(e,l,{q:t,t:a,sort:r})})}else p=!1,$("ul.pagination[role='navigation']").html(e),$(".bills").html(s)}),p||$(".sortable").click(function(){a=$(this).attr("sort");var e="{{Route::current()->getName()}}";e=-1==e.indexOf(".")?e:e.split(".")[0];var t=$(".search .searchbar").val();if(-1==$.inArray(a,i)?(i.length>0&&(i=[]),l="asc",$(this).addClass("sorted"),i.push(a)):(l="desc",$(this).removeClass("sorted"),i=[]),""!=t&&null!=t){var n=-1!="{{Route::current()->getName()}}".indexOf("bills")?"Bill":-1!="{{Route::current()->getName()}}".indexOf("customers")?"Customer":"Offer",s="{{route('search')}}",d=!1;i.length>0&&(d=i[0]),$.get(s,{q:t,t:n,sort:d},function(e){e.data,c(e.data),u(e,s,{q:t,t:n,sort:d})})}else o={sort_by:a,sort_dir:l,sort_page:e},r="{{route('sort')}}",$.get(r,o,function(e){c(e.data),u(e,r,o)})})}),window.onload=function(){for(var e=document.getElementsByClassName("ldBar"),t=0;t<e.length;t++)if(e[t].hasAttribute("data-text")){var a=e[t].getElementsByClassName("ldBar-label");a[0].innerHTML=e[t].getAttribute("data-text"),a[0].className+=" no-after"}document.querySelectorAll(".jssearch").forEach(function(e,t){var a=e.parentElement.parentElement,l=a.querySelector(".jssearch-select"),r=a.querySelector(".jssearch-change"),o=a.querySelector(".jssearch-selected"),n=a.parentElement.querySelector(".input-group-footer .selBtn"),s=a.parentElement.querySelector(".input-group-content .slist"),i=e.parentElement,c=a,d=a.parentElement.querySelector(".input-group-content"),u=a.parentElement.querySelector(".input-group-footer"),p=!1;s.onchange=function(){0==p&&(n.disabled=!1,n.className=n.className.replace("btn-secondary","btn-primary")),p=!0},r.onclick=function(){d.style.display="block",c.style.borderBottom="none",c.style.borderRadius=".25rem .25rem 0 0",u.style.display="block",i.style.display="block",this.style.display="none",o.innerHTML=""},l.onclick=function(){this.style.display="none",d.style.display="block",u.style.display="block",c.style.borderBottom="none",c.style.borderRadius=".25rem .25rem 0 0",i.style.display="block"},n.onclick=function(){d.style.display="none",c.style.borderBottom="1px solid #ced4da",c.style.borderRadius=".25rem",u.style.display="none",r.style.display="block",i.style.display="none",this.style.display="block",o.innerHTML=s.options[s.selectedIndex].text},e.onkeyup=function(){for(var e=this.value.toLowerCase(),t=s.querySelectorAll("option"),a=0;a<t.length;a++){if(null==e||""==e)t[a].style.display="block";else t[a].style.display="none",-1!=t[a].text.toLowerCase().indexOf(e)&&(t[a].style.display="block")}}});var l=document.querySelector(".product-table"),r=document.querySelector(".add-product"),o=document.querySelector(".price-total span"),n=document.querySelector(".vat-total span"),s=document.querySelector(".bill-total span"),i=0,c=0,d=JSON.parse("{{$vats}}".replace(/&quot;/g,'"'));r.onclick=function(){i=Number(o.innerHTML)>0?Number(o.innerHTML):0,c=Number(n.innerHTML)>0?Number(n.innerHTML):0;var e=l.querySelector("tbody"),t=document.createElement("tr"),a=document.createElement("th"),r=document.createElement("td"),u=document.createElement("td"),p=document.createElement("td"),m=document.createElement("td"),v=!1,h=document.createElement("input");h.className="form-control",h.setAttribute("type","number"),h.setAttribute("name","pid[]"),h.setAttribute("placeholder","{{$json->$hl->accounting->eg_id}}");var y=document.createElement("input");y.className="form-control",y.setAttribute("type","hidden"),y.setAttribute("name","prid[]"),y.value=0,a.appendChild(h),a.appendChild(y);var b=document.createElement("input");b.setAttribute("type","text"),b.setAttribute("name","product[]"),b.className="form-control",r.appendChild(b);var f=document.createElement("input");f.setAttribute("type","number"),f.setAttribute("name","price[]"),f.className="form-control",u.appendChild(f),u.className="price";var $=document.createElement("span");$.className="vat-text";var g=document.createElement("select");g.className="form-control vlist",g.setAttribute("name","vat[]");var q=document.createElement("option");for(vat of(q.setAttribute("value","0"),q.setAttribute("data-value","0"),q.innerHTML="{{$json->$hl->general->none}}",g.appendChild(q),d))(q=document.createElement("option")).setAttribute("value",vat.id),q.setAttribute("data-value",vat.vat_value),q.innerHTML=vat.vat_name+" ("+vat.vat_value+"%)",g.appendChild(q);p.appendChild($),p.appendChild(g);var x=document.createElement("a");x.setAttribute("href","javascript: void(0);"),x.className="ac-product";var S=document.createElement("i");S.className="{{$json->icons->checked}}",x.appendChild(S);var N=document.createElement("a");N.setAttribute("href","javascript: void(0);"),N.className="cancel-product";var C=document.createElement("i");C.className="{{$json->icons->close}}",N.appendChild(C),m.appendChild(x),m.appendChild(N),m.className="actions",t.appendChild(a),t.appendChild(r),t.appendChild(u),t.appendChild(p),t.appendChild(m),e.appendChild(t),N.onclick=function(){t.parentElement.removeChild(t);var e=""==u.querySelector(".form-control").value||null==u.querySelector(".form-control").value||isNaN(u.querySelector(".form-control").value)?0:u.querySelector(".form-control").value;if(i-=e,o.innerHTML=i.toFixed(2),0!=p.querySelector("select").value){var a=Number(p.querySelector("select").options[p.querySelector("select").selectedIndex].getAttribute("data-value")/100);c-=Number(e*a),n.innerHTML=c.toFixed(2).replace(/\-/g,"")}s.innerHTML=(i+c).toFixed(2).replace(/\-/g,"")},x.onclick=function(){if(""!=h.value&&null!=h.value&&""!=b.value&&null!=b.value&&""!=f.value&&null!=f.value)if(isNaN(f.value))alert("The price field can only contain numbers!");else{var e=a.querySelector(".form-control").value;a.querySelector(".form-control").setAttribute("type","hidden"),a.setAttribute("scope","row");var t=r.querySelector(".form-control").value;r.querySelector(".form-control").setAttribute("type","hidden");var l=Number(u.querySelector(".form-control").value);u.querySelector(".form-control").setAttribute("type","hidden"),vat_val=Number(p.querySelector("select").options[p.querySelector("select").selectedIndex].getAttribute("data-value")/100),0==v?(a.innerHTML="<span>"+e+"</span>"+a.innerHTML,r.innerHTML="<span>"+t+"</span>"+r.innerHTML,u.innerHTML='<span class="price-value">'+l.toFixed(2)+"</span>"+u.innerHTML,p.querySelector(".vat-text").innerHTML=p.querySelector("select").options[p.querySelector("select").selectedIndex].text+" "+Number(l*vat_val).toFixed(2)):(a.querySelector("span").innerHTML=e,r.querySelector("span").innerHTML=t,u.querySelector(".price-value").innerHTML=l.toFixed(2),p.querySelector(".vat-text").innerHTML=p.querySelector("select").options[p.querySelector("select").selectedIndex].text+" "+Number(l*vat_val).toFixed(2),a.querySelector("span").style.display="block",r.querySelector("span").style.display="block",u.querySelector(".currency").style.display="inline",u.querySelector(".price-value").style.display="inline",p.querySelector(".vat-text").style.display="block"),p.querySelector("select").style.display="none",0!=p.querySelector("select").value&&(c+=Number(l*vat_val)),n.innerHTML=c.toFixed(2),i+=Number(l),o.innerHTML=i.toFixed(2),s.innerHTML=(i+c).toFixed(2);var d=document.createElement("a");d.setAttribute("href","javascript: void(0);"),d.className="edit-product";var m=document.createElement("i");m.className="{{$json->icons->edit}}",d.appendChild(m),this.parentElement.insertBefore(d,this),this.style.display="none",v=!0,d.onclick=function(){this.style.display="none",x.style.display="inline",a.querySelector("span").style.display="none",r.querySelector("span").style.display="none",u.querySelector(".price-value").style.display="none",u.querySelector(".currency").style.display="none",p.querySelector(".vat-text").style.display="none",p.querySelector("select").style.display="block",a.querySelector(".form-control").setAttribute("type","number"),r.querySelector(".form-control").setAttribute("type","text"),u.querySelector(".form-control").setAttribute("type","number"),i-=Number(l),c-=Number(l*vat_val)}}else alert("Please fill out everything")}};const u=document.querySelector(".filter"),p=document.querySelector(".add-bill"),m=document.querySelector(".close-bill"),v=document.querySelector(".add-bill-form");p.onclick=function(){u.style.display="block",v.style.display="block",document.querySelector(".add-bill-form form").setAttribute("action","{{route('bills.index')}}"),document.querySelector(".add-bill-form .sbm").value="{{$json->$hl->accounting->add}} {{$json->$hl->accounting->bill}}",document.querySelector(".add-bill-form .box-header h4").innerHTML="{{$json->$hl->accounting->new_bill}}",document.querySelector(".add-bill-form .input-group-content").style.display="none",document.querySelector(".add-bill-form .input-group-footer").style.display="none",document.querySelector(".add-bill-form .input-group-search").style.display="none",document.querySelector(".add-bill-form .jssearch-change").style.display="block",document.querySelector(".add-bill-form .jssearch-select").style.display="none",document.querySelector(".add-bill-form .input-group-header").style.borderRadius="0.25rem",document.querySelector(".add-bill-form .input-group-header").style.borderBottom="1px solid #ced4da",document.querySelector(".jssearch-change").style.display="none",document.querySelector(".jssearch-select").style.display="block",document.querySelector(".add-bill-form form input[value='PATCH']")&&document.querySelector(".add-bill-form form").removeChild(document.querySelector(".add-bill-form form input[value='PATCH']"))},m.onclick=function(){u.style.display="none",v.style.display="none",v.querySelector(".bid"),v.querySelector(".product-table .table-body").innerHTML="",v.querySelector(".product-table .price-total span").innerHTML=(0).toFixed(2),v.querySelector(".product-table .vat-total span").innerHTML=(0).toFixed(2),v.querySelector(".product-table .bill-total span").innerHTML=(0).toFixed(2),v.querySelector(".slist").value="",v.querySelector(".jssearch-selected").innerHTML="",v.querySelector(".bid").value="{{$bills->highestId}}"};const h=document.querySelectorAll(".alert-close");for(alert_close of h)alert_close.onclick=function(){const e=this.parentElement;this.parentElement.parentElement.removeChild(e)}};</script>